import asyncio
from pyppeteer import launch
from logzero import logger

# Credentials flagger: 9fca351e31d44ff8b6ddcefd70be5c56
FLAGGER_PW = 'password'


async def bot_message(page, title, text):
    # Add a note

    await page.type('#title', title)
    await page.type('#body', text)
    await asyncio.wait([
        page.click('#submit'),
        page.waitForNavigation(),
    ])

async def login():
    browser = await launch()
    page = await browser.newPage()
    await asyncio.wait([
            page.goto('http://127.0.0.1:5000/'),
            page.waitForNavigation(),
        ])
    
    await asyncio.sleep(2)
    await page.type('#username', 'flagger')
    await page.type('#password', FLAGGER_PW)
    await asyncio.wait([
        page.click('#login'),
        page.waitForNavigation(),
    ])
    return page


async def main():

    page = await login()
    print(f"Content of page after login: {await page.content()}")
    
    await page.screenshot({'path': 'before.png'})

    for i in range(10):
        await bot_message(page, 'TEST', str(i))
        logger.info(f"Inserted testnote {i}")
    
    await page.screenshot({'path': 'after.png'})

asyncio.get_event_loop().run_until_complete(main())